<!DOCTYPE html>
<html>
<head>
  <title>S3 File Uploader</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
    .upload-container { border: 2px dashed #ccc; padding: 20px; text-align: center; }
    #status { margin-top: 15px; color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="upload-container">
    <h2>Upload File to S3</h2>
    <input type="file" id="fileInput">
    <button onclick="uploadFile()">Upload</button>
    <div id="status"></div>
  </div>

  <script>
    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = '';
      statusDiv.className = '';

      if (!fileInput.files.length) {
        showStatus('Please select a file first!', 'error');
        return;
      }

      const file = fileInput.files[0];
      showStatus('Generating upload URL...');

      try {
        // 1. Get pre-signed URL from your Lambda
        const response = await fetch(
          'https://8n4qwlw0qf.execute-api.ap-southeast-2.amazonaws.com/dev',
          {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              // Add this if your API requires CORS:
              'Origin': window.location.origin
            },
            body: JSON.stringify({
              fileName: file.name,
              fileType: file.type || 'application/octet-stream'
            })
          }
        );

        if (!response.ok) {
          const error = await response.text();
          throw new Error(`API Error: ${error}`);
        }

        const { uploadURL } = await response.json();
        showStatus('Uploading file to S3...');

        // 2. Upload directly to S3
        const uploadResponse = await fetch(uploadURL, {
          method: 'PUT',
          headers: {
            'Content-Type': file.type || 'application/octet-stream'
          },
          body: file
        });

        if (uploadResponse.ok) {
          showStatus('File uploaded successfully!');
        } else {
          const s3Error = await uploadResponse.text();
          throw new Error(`S3 Upload Failed: ${s3Error}`);
        }
      } catch (error) {
        showStatus(`Error: ${error.message}`, 'error');
        console.error('Upload error:', error);
      }
    }

    function showStatus(message, type = '') {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = type;
    }
  </script>
</body>
</html>
