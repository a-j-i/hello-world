<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Page</title>
  <script src="https://unpkg.com/aws-amplify@5.0.4/dist/aws-amplify.min.js"></script>
</head>
<body>
  <h1>Welcome to the Portal</h1>

  <div id="auth-section">
    <button onclick="signIn()">Login</button>
    <button onclick="signOut()">Logout</button>
  </div>

  <div id="user-info" style="display:none;">
    <h2 id="user-email"></h2>
  </div>

  <script>
    const { Auth } = window.Amplify;

    // ✅ Amplify configuration
    Amplify.configure({
      Auth: {
        region: 'ap-southeast-2', // or your region
        userPoolId: 'ap-southeast-2_yJYKaxRIy',
        userPoolWebClientId: '5e6bndcs0tvos87fndb63urr92',
        oauth: {
          domain: 'https://ap-southeast-2yjykaxriy.auth.ap-southeast-2.amazoncognito.com',
          scope: ['email', 'openid'],
          redirectSignIn: window.location.href,
          redirectSignOut: window.location.href,
          responseType: 'token',
        },
      }
    });

    async function signIn() {
      try {
        await Auth.federatedSignIn(); // redirects to Cognito login
      } catch (err) {
        console.error("Login error:", err);
      }
    }

    async function signOut() {
      await Auth.signOut();
      location.reload();
    }

    // ✅ Check login status and show user email
    window.onload = async () => {
      try {
        const user = await Auth.currentAuthenticatedUser();
        document.getElementById("user-info").style.display = "block";
        document.getElementById("user-email").innerText = `Logged in as: ${user.attributes.email}`;
      } catch {
        console.log("User not logged in");
      }
    };
  </script>
</body>
</html>
